# 在传统的方式下，为增加网站性能，优化方案

![image-20211210110409382](C:\Users\96217\AppData\Roaming\Typora\typora-user-images\image-20211210110409382.png)

1. ### 数据库增加索引 
```shell
alter table tb_category add index parent_id (parent_id) ;
```
2. ### themleaf打开缓存
```yaml
spring:
  # 开发阶段为测试方便关闭；生产阶段可打开缓存
  thymeleaf:
    cache: true
```
前 ：

![image-20211210104431262](C:\Users\96217\AppData\Roaming\Typora\typora-user-images\image-20211210104431262.png)

后 ：



![image-20211210104307629](C:\Users\96217\AppData\Roaming\Typora\typora-user-images\image-20211210104307629.png)

吞吐量从 10/sec 左右   增加至   18/sec 左右



3. ### nginx 动静分离

   将 微服务

   ![image-20211210105950669](C:\Users\96217\AppData\Roaming\Typora\typora-user-images\image-20211210105950669.png)

   下的static 文件 ，拷贝到 nginx 下的html 目录下

   然后配置

   nginx.conf 

   ```shell
       # 静态资源
       location /static {
           root html;
       }
       # 动态资源
       location / {
           #设置请求头
           proxy_set_header Host $host;     
           proxy_pass http://cubemall;
       }
   ```



同时将 index.html 中 路径  

`./index`

改为

`./static/index`

前

![image-20211210104307629](C:\Users\96217\AppData\Roaming\Typora\typora-user-images\image-20211210104307629.png)



后

![image-20211210110441527](C:\Users\96217\AppData\Roaming\Typora\typora-user-images\image-20211210110441527.png)





### 加入 redis 缓存



```java
public List<CategoryEntity> getLevel1Categories() {
    String categoryJSON = (String) redisTemplate.opsForValue().get("categoryJSON");
    if (StringUtils.isEmpty(categoryJSON)) {
        // 从数据库查询
        List<CategoryEntity> tree = listWithTree();

        // 缓存进 redis
        String treeJSON = JSON.toJSONString(tree);
        redisTemplate.opsForValue().set("categoryJSON", treeJSON);
        return tree;
    }
    return JSON.parseArray(categoryJSON,CategoryEntity.class);

}
```



前

![image-20211210110441527](C:\Users\96217\AppData\Roaming\Typora\typora-user-images\image-20211210110441527.png)

后

![image-20211210114054204](C:\Users\96217\AppData\Roaming\Typora\typora-user-images\image-20211210114054204.png)

